# Dockerfile для Day in History Bot
# =============================================================================

FROM python:3.10-slim

# =============================================================================
# НАСТРОЙКА ОКРУЖЕНИЯ
# =============================================================================

# Отключаем буферизацию вывода Python (для логов в реальном времени)
ENV PYTHONUNBUFFERED=1

# Рабочая директория
WORKDIR /app

# =============================================================================
# УСТАНОВКА ЗАВИСИМОСТЕЙ
# =============================================================================

# Копируем файл с зависимостями
COPY requirements.txt .

# Устанавливаем зависимости
RUN pip install --no-cache-dir -r requirements.txt

# =============================================================================
# КОПИРОВАНИЕ КОДА
# =============================================================================

# Создаем структуру директорий
RUN mkdir -p /app/src /app/data /app/logs

# Копируем исходный код
COPY src/ /app/src/

# =============================================================================
# НАСТРОЙКА ПРАВ
# =============================================================================

# Создаем пользователя для запуска (не root)
RUN useradd -m -u 1000 botuser && \
    chown -R botuser:botuser /app

# Переключаемся на пользователя
USER botuser

# =============================================================================
# ЗАПУСК
# =============================================================================

# Запускаем бота
CMD ["python", "-u", "src/bot.py"]