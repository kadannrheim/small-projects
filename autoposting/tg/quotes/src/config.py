#!/usr/bin/env python3
# -*- coding: utf-8 -*-

"""
–ú–æ–¥—É–ª—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Telegram Quotes Bot
=======================================

–≠—Ç–æ—Ç –º–æ–¥—É–ª—å –æ—Ç–≤–µ—á–∞–µ—Ç –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
–û–Ω —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø—Ä–∏–Ω—Ü–∏–ø—ã 12-factor app:
    - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
    - –ù–µ—Ç —Å–µ–∫—Ä–µ—Ç–æ–≤ –≤ –∫–æ–¥–µ
    - –û–∫—Ä—É–∂–µ–Ω–∏—è (dev/prod) –æ—Ç–ª–∏—á–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ .env —Ñ–∞–π–ª–∞–º–∏

–û—Å–Ω–æ–≤–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:
    - –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ .env —Ñ–∞–π–ª–∞
    - –í–∞–ª–∏–¥–∞—Ü–∏—è –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    - –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ (str -> int, bool)
    - –ó–Ω–∞—á–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
    - –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

–ê–≤—Ç–æ—Ä: kadannr
–í–µ—Ä—Å–∏—è: 1.0.0
"""

import os
from dataclasses import dataclass, field
from typing import Optional
from pathlib import Path

# –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ .env —Ñ–∞–π–ª–∞
from dotenv import load_dotenv

# =============================================================================
# –ó–ê–ì–†–£–ó–ö–ê .ENV –§–ê–ô–õ–ê
# =============================================================================

# –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø—É—Ç—å –∫ .env —Ñ–∞–π–ª—É
# –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:
#   /project
#   ‚îú‚îÄ‚îÄ docker-compose.yml
#   ‚îú‚îÄ‚îÄ .env
#   ‚îî‚îÄ‚îÄ quotes/
#       ‚îú‚îÄ‚îÄ bot.py
#       ‚îî‚îÄ‚îÄ config.py
env_path = Path(__file__).parent.parent / '.env'

if env_path.exists():
    # –ó–∞–≥—Ä—É–∂–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ .env —Ñ–∞–π–ª–∞
    # override=False –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è
    load_dotenv(env_path, override=False)
    print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω .env —Ñ–∞–π–ª: {env_path}")
else:
    print(f"‚ö†Ô∏è .env —Ñ–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω –ø–æ –ø—É—Ç–∏: {env_path}")
    print("üí° –ë–æ—Ç –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è")


# =============================================================================
# –ö–õ–ê–°–° –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# =============================================================================

@dataclass
class Config:
    """
    –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.
    
    –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ dataclass –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç:
        - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫—É—é –≥–µ–Ω–µ—Ä–∞—Ü–∏—é __init__
        - –ß–∏—Ç–∞–µ–º—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å —Ç–∏–ø–∞–º–∏ –ø–æ–ª–µ–π
        - –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –¥–æ–±–∞–≤–ª—è—Ç—å –º–µ—Ç–æ–¥—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏
    
    –í—Å–µ –ø–æ–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è —Å –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.
    –≠—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≥–∏–±–∫–æ–π –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ–π.
    
    Attributes:
        # Telegram (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
        tg_q_bot_token: –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather
        tg_q_channel_id: ID –∫–∞–Ω–∞–ª–∞ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä @channel –∏–ª–∏ -1001234567890)
        
        # Scheduler (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
        base_hour: –ß–∞—Å –±–∞–∑–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (0-23, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 9)
        base_minute: –ú–∏–Ω—É—Ç–∞ –±–∞–∑–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (0-59, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 0)
        random_range_minutes: –î–∏–∞–ø–∞–∑–æ–Ω —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–º–µ—â–µ–Ω–∏—è –≤ –º–∏–Ω—É—Ç–∞—Ö (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 30)
        
        # Files (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
        quotes_file: –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É —Å —Ü–∏—Ç–∞—Ç–∞–º–∏
        history_file: –ü—É—Ç—å –∫ JSON —Ñ–∞–π–ª—É –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–π
        
        # Logging (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
        log_level: –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è (DEBUG, INFO, WARNING, ERROR)
        log_file: –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤
        
        # Additional (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ)
        timezone: –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞
        request_timeout: –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API (—Å–µ–∫—É–Ω–¥—ã)
        disable_notifications: –û—Ç–∫–ª—é—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram
        send_test_quote: –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ü–∏—Ç–∞—Ç—É –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ
        max_retries: –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
        retry_delay: –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ (—Å–µ–∫—É–Ω–¥—ã)
    """
    
    # =========================================================================
    # TELEGRAM –ù–ê–°–¢–†–û–ô–ö–ò (–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–´–ï)
    # =========================================================================
    
    tg_q_bot_token: str = field(
        default_factory=lambda: os.getenv('TG_Q_BOT_TOKEN', '')
    )
    """
    –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ—Ç @BotFather.
    
    –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä. –ë–µ–∑ –Ω–µ–≥–æ –±–æ—Ç –Ω–µ —Å–º–æ–∂–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Å–æ–æ–±—â–µ–Ω–∏—è.
    –ü—Ä–∏–º–µ—Ä: "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
    
    –ü–æ–ª—É—á–∏—Ç—å: @BotFather –≤ Telegram -> /newbot
    """
    
    tg_q_channel_id: str = field(
        default_factory=lambda: os.getenv('TG_Q_CHANNEL_ID', '')
    )
    """
    ID –∫–∞–Ω–∞–ª–∞ –¥–ª—è –ø—É–±–ª–∏–∫–∞—Ü–∏–π.
    
    –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä. –ö—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ü–∏—Ç–∞—Ç—ã.
    –§–æ—Ä–º–∞—Ç—ã:
        - –ü—É–±–ª–∏—á–Ω—ã–π –∫–∞–Ω–∞–ª: "@channel_name"
        - –ü—Ä–∏–≤–∞—Ç–Ω—ã–π –∫–∞–Ω–∞–ª: "-1001234567890" (—á–∏—Å–ª–æ–≤–æ–π ID)
    
    –ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å: @username_to_id_bot –≤ Telegram
    """
    
    # =========================================================================
    # –ù–ê–°–¢–†–û–ô–ö–ò –ü–õ–ê–ù–ò–†–û–í–©–ò–ö–ê
    # =========================================================================
    
    base_hour: int = field(
        default_factory=lambda: int(os.getenv('TG_Q_BASE_HOUR', '9'))
    )
    """
    –ß–∞—Å –±–∞–∑–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (0-23).
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 9 (9 —É—Ç—Ä–∞)
    –ë–æ—Ç –±—É–¥–µ—Ç –ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å —Ü–∏—Ç–∞—Ç—ã –æ–∫–æ–ª–æ —ç—Ç–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –∫–∞–∂–¥—ã–π –¥–µ–Ω—å.
    """
    
    base_minute: int = field(
        default_factory=lambda: int(os.getenv('TG_Q_BASE_MINUTE', '0'))
    )
    """
    –ú–∏–Ω—É—Ç–∞ –±–∞–∑–æ–≤–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (0-59).
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 0
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å base_hour.
    """
    
    random_range_minutes: int = field(
        default_factory=lambda: int(os.getenv('TG_Q_RANDOM_RANGE_MINUTES', '30'))
    )
    """
    –î–∏–∞–ø–∞–∑–æ–Ω —Å–ª—É—á–∞–π–Ω–æ–≥–æ —Å–º–µ—â–µ–Ω–∏—è –≤ –º–∏–Ω—É—Ç–∞—Ö.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 30
    –§–∞–∫—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ = base_hour:base_minute ¬± random_range_minutes
    –ù–∞–ø—Ä–∏–º–µ—Ä, –ø—Ä–∏ base_hour=9, random_range=30, –≤—Ä–µ–º—è –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç 8:30 –¥–æ 9:30.
    """
    
    # =========================================================================
    # –ù–ê–°–¢–†–û–ô–ö–ò –§–ê–ô–õ–û–í
    # =========================================================================
    
    quotes_file: str = field(
        default_factory=lambda: os.getenv('QUOTES_FILE', 'data/quotes365.json')
    )
    """
    –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É —Å —Ü–∏—Ç–∞—Ç–∞–º–∏.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: "data/quotes365.json"
    –§–æ—Ä–º–∞—Ç: JSON –º–∞—Å—Å–∏–≤ –æ–±—ä–µ–∫—Ç–æ–≤ —Å –ø–æ–ª—è–º–∏ "text", "author", "hashtag"
    
    –ü—Ä–∏–º–µ—Ä:
        [
            {
                "text": "–¢–µ–∫—Å—Ç —Ü–∏—Ç–∞—Ç—ã",
                "author": "–ê–≤—Ç–æ—Ä",
                "hashtag": "#—Ü–∏—Ç–∞—Ç—ã"
            }
        ]
    """
    
    history_file: str = field(
        default_factory=lambda: os.getenv('HISTORY_FILE', 'data/published_history.json')
    )
    """
    –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –∏—Å—Ç–æ—Ä–∏–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–π.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: "data/published_history.json"
    –§–æ—Ä–º–∞—Ç: JSON –æ–±—ä–µ–∫—Ç { "—Ç–µ–∫—Å—Ç —Ü–∏—Ç–∞—Ç—ã": "–¥–∞—Ç–∞ YYYY-MM-DD" }
    
    –ü—Ä–∏–º–µ—Ä:
        {
            "–ë—ã—Ç—å –∏–ª–∏ –Ω–µ –±—ã—Ç—å...": "2026-02-19",
            "–Ø –º—ã—Å–ª—é, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Å—É—â–µ—Å—Ç–≤—É—é": "2026-02-20"
        }
    """
    
    # =========================================================================
    # –ù–ê–°–¢–†–û–ô–ö–ò –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø
    # =========================================================================
    
    log_level: str = field(
        default_factory=lambda: os.getenv('LOG_LEVEL', 'INFO')
    )
    """
    –£—Ä–æ–≤–µ–Ω—å –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: "INFO"
    –í–æ–∑–º–æ–∂–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è:
        - DEBUG: –í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏)
        - INFO: –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è (–¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)
        - WARNING: –¢–æ–ª—å–∫–æ –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è
        - ERROR: –¢–æ–ª—å–∫–æ –æ—à–∏–±–∫–∏
    """
    
    log_file: str = field(
        default_factory=lambda: os.getenv('LOG_FILE', 'logs/bot.log')
    )
    """
    –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –ª–æ–≥–æ–≤.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: "logs/bot.log"
    –ï—Å–ª–∏ —É–∫–∞–∑–∞–Ω None –∏–ª–∏ –ø—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ - –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Å–æ–ª—å.
    """
    
    # =========================================================================
    # –î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –ù–ê–°–¢–†–û–ô–ö–ò
    # =========================================================================
    
    timezone: str = field(
        default_factory=lambda: os.getenv('TIMEZONE', 'Europe/Moscow')
    )
    """
    –ß–∞—Å–æ–≤–æ–π –ø–æ—è—Å –¥–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–∞.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: "Europe/Moscow"
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.
    –°–ø–∏—Å–æ–∫: https://en.wikipedia.org/wiki/List_of_tz_database_time_zones
    """
    
    request_timeout: int = field(
        default_factory=lambda: int(os.getenv('REQUEST_TIMEOUT', '10'))
    )
    """
    –¢–∞–π–º–∞—É—Ç –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ Telegram API –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 10
    –ï—Å–ª–∏ –æ—Ç–≤–µ—Ç –æ—Ç Telegram –Ω–µ –ø–æ–ª—É—á–µ–Ω –∑–∞ —ç—Ç–æ –≤—Ä–µ–º—è - –∑–∞–ø—Ä–æ—Å –ø—Ä–µ—Ä—ã–≤–∞–µ—Ç—Å—è.
    """
    
    disable_notifications: bool = field(
        default_factory=lambda: os.getenv('DISABLE_NOTIFICATIONS', 'false').lower() == 'true'
    )
    """
    –û—Ç–∫–ª—é—á–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram –ø—Ä–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: false
    –ï—Å–ª–∏ true - –ø–æ–¥–ø–∏—Å—á–∏–∫–∏ –Ω–µ –ø–æ–ª—É—á–∞—Ç –∑–≤—É–∫–æ–≤–æ–π —Å–∏–≥–Ω–∞–ª –æ –Ω–æ–≤–æ–º —Å–æ–æ–±—â–µ–Ω–∏–∏.
    """
    
    send_test_quote: bool = field(
        default_factory=lambda: os.getenv('SEND_TEST_QUOTE', 'true').lower() == 'true'
    )
    """
    –û—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–µ—Å—Ç–æ–≤—É—é —Ü–∏—Ç–∞—Ç—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –±–æ—Ç–∞.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: true
    –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –ø—Ä–∏ –¥–µ–ø–ª–æ–µ.
    """
    
    max_retries: int = field(
        default_factory=lambda: int(os.getenv('MAX_RETRIES', '3'))
    )
    """
    –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 3
    –ü—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö (—Ç–∞–π–º–∞—É—Ç, —Å–µ—Ç—å) –±–æ—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç –ø–æ–ø—ã—Ç–∫—É.
    """
    
    retry_delay: int = field(
        default_factory=lambda: int(os.getenv('RETRY_DELAY', '5'))
    )
    """
    –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –ø–æ–≤—Ç–æ—Ä–Ω—ã–º–∏ –ø–æ–ø—ã—Ç–∫–∞–º–∏ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö.
    
    –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é: 5
    –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–º–µ—Å—Ç–µ —Å max_retries.
    """
    
    # =========================================================================
    # –ú–ï–¢–û–î–´ –ü–û–°–¢-–û–ë–†–ê–ë–û–¢–ö–ò
    # =========================================================================
    
    def __post_init__(self):
        """
        –ü–æ—Å—Ç-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è: –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞.
        
        –ó–¥–µ—Å—å –º—ã:
            1. –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º –æ—Ç–Ω–æ—Å–∏—Ç–µ–ª—å–Ω—ã–µ –ø—É—Ç–∏ –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ
            2. –°–æ–∑–¥–∞–µ–º –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
            3. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ç–∏–ø–æ–≤
        """
        # ---------------------------------------------------------------------
        # –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ –ø—É—Ç–µ–π –≤ –∞–±—Å–æ–ª—é—Ç–Ω—ã–µ
        # ---------------------------------------------------------------------
        # –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫–æ—Ä–µ–Ω—å –ø—Ä–æ–µ–∫—Ç–∞ (–¥–≤–∞ —É—Ä–æ–≤–Ω—è –≤–≤–µ—Ä—Ö –æ—Ç config.py)
        project_root = Path(__file__).parent.parent
        
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º quotes_file
        if not os.path.isabs(self.quotes_file):
            self.quotes_file = str(project_root / self.quotes_file)
        
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º history_file
        if not os.path.isabs(self.history_file):
            self.history_file = str(project_root / self.history_file)
        
        # –ü—Ä–µ–æ–±—Ä–∞–∑—É–µ–º log_file
        if self.log_file and not os.path.isabs(self.log_file):
            self.log_file = str(project_root / self.log_file)
        
        # ---------------------------------------------------------------------
        # –°–æ–∑–¥–∞–Ω–∏–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–π
        # ---------------------------------------------------------------------
        # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤
        if self.log_file:
            log_dir = os.path.dirname(self.log_file)
            if log_dir:
                try:
                    Path(log_dir).mkdir(parents=True, exist_ok=True)
                except Exception as e:
                    print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –ª–æ–≥–æ–≤: {e}")
        
        # –°–æ–∑–¥–∞–µ–º –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö
        data_dir = os.path.dirname(self.quotes_file)
        if data_dir:
            try:
                Path(data_dir).mkdir(parents=True, exist_ok=True)
            except Exception as e:
                print(f"‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—é –¥–ª—è –¥–∞–Ω–Ω—ã—Ö: {e}")
    
    # =========================================================================
    # –ú–ï–¢–û–î–´ –í–ê–õ–ò–î–ê–¶–ò–ò
    # =========================================================================
    
    def validate(self) -> bool:
        """
        –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.
        
        –í–∞–ª–∏–¥–∞—Ü–∏—è –≤–∫–ª—é—á–∞–µ—Ç:
            - –ù–∞–ª–∏—á–∏–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π (—Ç–æ–∫–µ–Ω, ID –∫–∞–Ω–∞–ª–∞)
            - –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π (–¥–∏–∞–ø–∞–∑–æ–Ω—ã)
            - –§–æ—Ä–º–∞—Ç –∑–Ω–∞—á–µ–Ω–∏–π (—Ç–æ–∫–µ–Ω, ID)
        
        Returns:
            bool: True –µ—Å–ª–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –≤–∞–ª–∏–¥–Ω–∞
            
        Raises:
            ValueError: –û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è–º–∏
            
        Example:
            >>> config.validate()
            True
        """
        # ---------------------------------------------------------------------
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã—Ö –ø–æ–ª–µ–π
        # ---------------------------------------------------------------------
        if not self.tg_q_bot_token:
            raise ValueError(
                "‚ùå TG_Q_BOT_TOKEN –Ω–µ —É–∫–∞–∑–∞–Ω.\n"
                "üí° –ü–æ–ª—É—á–∏—Ç–µ —Ç–æ–∫–µ–Ω —É @BotFather –≤ Telegram –∏ –¥–æ–±–∞–≤—å—Ç–µ –µ–≥–æ –≤ .env —Ñ–∞–π–ª"
            )
        
        if not self.tg_q_channel_id:
            raise ValueError(
                "‚ùå TG_Q_CHANNEL_ID –Ω–µ —É–∫–∞–∑–∞–Ω.\n"
                "üí° –£–∫–∞–∂–∏—Ç–µ ID –∫–∞–Ω–∞–ª–∞ –≤ .env —Ñ–∞–π–ª–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä @my_channel –∏–ª–∏ -1001234567890)"
            )
        
        # ---------------------------------------------------------------------
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ —Ç–æ–∫–µ–Ω–∞ (–±–∞–∑–æ–≤–∞—è)
        # ---------------------------------------------------------------------
        # –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –æ–±—ã—á–Ω–æ –≤—ã–≥–ª—è–¥–∏—Ç –∫–∞–∫ "1234567890:ABCdefGHIjklMNOpqrsTUVwxyz"
        if len(self.tg_q_bot_token) < 40:
            raise ValueError(
                f"‚ùå TG_Q_BOT_TOKEN –∏–º–µ–µ—Ç –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –¥–ª–∏–Ω—É: {len(self.tg_q_bot_token)} —Å–∏–º–≤–æ–ª–æ–≤.\n"
                f"üí° –û–±—ã—á–Ω–æ —Ç–æ–∫–µ–Ω –¥–ª–∏–Ω–Ω–µ–µ 40 —Å–∏–º–≤–æ–ª–æ–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è"
            )
        
        if ':' not in self.tg_q_bot_token:
            raise ValueError(
                f"‚ùå TG_Q_BOT_TOKEN –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç —Ä–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å ':'\n"
                f"üí° –¢–æ–∫–µ–Ω –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –¥–≤–æ–µ—Ç–æ—á–∏–µ (–ø—Ä–∏–º–µ—Ä: 123456:ABCdef)"
            )
        
        # ---------------------------------------------------------------------
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞ channel ID
        # ---------------------------------------------------------------------
        if not (self.tg_q_channel_id.startswith('@') or 
                self.tg_q_channel_id.startswith('-100')):
            raise ValueError(
                f"‚ùå TG_Q_CHANNEL_ID –∏–º–µ–µ—Ç –Ω–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç: {self.tg_q_channel_id}\n"
                f"üí° –ö–∞–Ω–∞–ª –¥–æ–ª–∂–µ–Ω –Ω–∞—á–∏–Ω–∞—Ç—å—Å—è —Å @ (–ø—É–±–ª–∏—á–Ω—ã–π) –∏–ª–∏ -100 (–ø—Ä–∏–≤–∞—Ç–Ω—ã–π)"
            )
        
        # ---------------------------------------------------------------------
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —á–∏—Å–ª–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π
        # ---------------------------------------------------------------------
        if not 0 <= self.base_hour <= 23:
            raise ValueError(
                f"‚ùå base_hour –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 23, –ø–æ–ª—É—á–µ–Ω–æ {self.base_hour}\n"
                f"üí° –ß–∞—Å—ã —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤ 24-—á–∞—Å–æ–≤–æ–º —Ñ–æ—Ä–º–∞—Ç–µ"
            )
        
        if not 0 <= self.base_minute <= 59:
            raise ValueError(
                f"‚ùå base_minute –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ—Ç 0 –¥–æ 59, –ø–æ–ª—É—á–µ–Ω–æ {self.base_minute}\n"
                f"üí° –ú–∏–Ω—É—Ç—ã —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –æ—Ç 0 –¥–æ 59"
            )
        
        if self.random_range_minutes < 0:
            raise ValueError(
                f"‚ùå random_range_minutes –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Ç—Ä–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–º: {self.random_range_minutes}\n"
                f"üí° –î–∏–∞–ø–∞–∑–æ–Ω –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º —á–∏—Å–ª–æ–º"
            )
        
        if self.request_timeout <= 0:
            raise ValueError(
                f"‚ùå request_timeout –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–æ–ª–æ–∂–∏—Ç–µ–ª—å–Ω—ã–º: {self.request_timeout}\n"
                f"üí° –¢–∞–π–º–∞—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –±–æ–ª—å—à–µ 0 —Å–µ–∫—É–Ω–¥"
            )
        
        # ---------------------------------------------------------------------
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Ä–æ–≤–Ω—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
        # ---------------------------------------------------------------------
        valid_log_levels = ['DEBUG', 'INFO', 'WARNING', 'ERROR']
        if self.log_level.upper() not in valid_log_levels:
            raise ValueError(
                f"‚ùå log_level –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –æ–¥–Ω–∏–º –∏–∑ {valid_log_levels}, –ø–æ–ª—É—á–µ–Ω–æ {self.log_level}\n"
                f"üí° –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ —É—Ä–æ–≤–Ω–∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è Python"
            )
        
        # ---------------------------------------------------------------------
        # –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤ (–ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è, –Ω–µ –æ—à–∏–±–∫–∏)
        # ---------------------------------------------------------------------
        quotes_path = Path(self.quotes_file)
        if not quotes_path.exists():
            print(f"‚ö†Ô∏è –í–ù–ò–ú–ê–ù–ò–ï: –§–∞–π–ª —Ü–∏—Ç–∞—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω: {quotes_path}")
            print("üí° –ë–æ—Ç —Å–æ–∑–¥–∞—Å—Ç –µ–≥–æ –ø—Ä–∏ –ø–µ—Ä–≤–æ–π –ø—É–±–ª–∏–∫–∞—Ü–∏–∏, –Ω–æ –ª—É—á—à–µ —Å–æ–∑–¥–∞—Ç—å –∑–∞—Ä–∞–Ω–µ–µ")
        
        return True
    
    # =========================================================================
    # –í–°–ü–û–ú–û–ì–ê–¢–ï–õ–¨–ù–´–ï –ú–ï–¢–û–î–´
    # =========================================================================
    
    def as_dict(self) -> dict:
        """
        –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –≤ –≤–∏–¥–µ —Å–ª–æ–≤–∞—Ä—è (–±–µ–∑ —Å–µ–∫—Ä–µ—Ç–æ–≤).
        
        –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–ª–∞–¥–∫–∏ - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏,
        –Ω–æ –º–∞—Å–∫–∏—Ä—É–µ—Ç —Ç–æ–∫–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏.
        
        Returns:
            dict: –°–ª–æ–≤–∞—Ä—å —Å–æ –≤—Å–µ–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ (—Ç–æ–∫–µ–Ω –º–∞—Å–∫–∏—Ä—É–µ—Ç—Å—è)
            
        Example:
            >>> config.as_dict()
            {
                'tg_q_channel_id': '@my_channel',
                'base_hour': 9,
                'base_minute': 0,
                'tg_q_bot_token': '123456...xyz'
            }
        """
        # –°–æ–±–∏—Ä–∞–µ–º –≤—Å–µ –ø—É–±–ª–∏—á–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
        config_dict = {
            'tg_q_channel_id': self.tg_q_channel_id,
            'base_hour': self.base_hour,
            'base_minute': self.base_minute,
            'random_range_minutes': self.random_range_minutes,
            'quotes_file': self.quotes_file,
            'history_file': self.history_file,
            'log_level': self.log_level,
            'log_file': self.log_file,
            'timezone': self.timezone,
            'request_timeout': self.request_timeout,
            'disable_notifications': self.disable_notifications,
            'send_test_quote': self.send_test_quote,
            'max_retries': self.max_retries,
            'retry_delay': self.retry_delay,
        }
        
        # –ú–∞—Å–∫–∏—Ä—É–µ–º —Ç–æ–∫–µ–Ω –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
        if self.tg_q_bot_token:
            token = self.tg_q_bot_token
            if len(token) > 10:
                # –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–µ—Ä–≤—ã–µ 6 –∏ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 4 —Å–∏–º–≤–æ–ª–∞
                masked = token[:6] + '...' + token[-4:]
            else:
                masked = '***'
            config_dict['tg_q_bot_token'] = masked
        
        return config_dict
    
    def __repr__(self) -> str:
        """
        –°—Ç—Ä–æ–∫–æ–≤–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏.
        
        Returns:
            str: –ß–∏—Ç–∞–µ–º–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        """
        config_dict = self.as_dict()
        items = [f"{k}={v}" for k, v in config_dict.items()]
        return f"Config({', '.join(items)})"


# =============================================================================
# –ì–õ–û–ë–ê–õ–¨–ù–´–ô –û–ë–™–ï–ö–¢ –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–ò
# =============================================================================

# –°–æ–∑–¥–∞–µ–º –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤–æ –≤—Å–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏
# –≠—Ç–æ –ø–∞—Ç—Ç–µ—Ä–Ω Singleton - –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ –≤—Å–µ –º–æ–¥—É–ª–∏ –∏—Å–ø–æ–ª—å–∑—É—é—Ç –û–î–ò–ù –æ–±—ä–µ–∫—Ç
config = Config()

# –î–ª—è —É–¥–æ–±—Å—Ç–≤–∞ –∏–º–ø–æ—Ä—Ç–∞: from config import config
# –¢–µ–ø–µ—Ä—å –ª—é–±–æ–π –º–æ–¥—É–ª—å –º–æ–∂–µ—Ç –ø–æ–ª—É—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –∫ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º:
#   from config import config
#   print(config.tg_q_channel_id)
# =============================================================================
# –ö–û–ù–ï–¶ –§–ê–ô–õ–ê
# =============================================================================